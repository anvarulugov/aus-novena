!function(){"use strict";function e(e,t,n,o){var l,r=!1,a=0;function c(){l&&clearTimeout(l)}function i(){for(var i=arguments.length,s=new Array(i),u=0;u<i;u++)s[u]=arguments[u];var p=this,f=Date.now()-a;function m(){a=Date.now(),n.apply(p,s)}function b(){l=void 0}r||(o&&!l&&m(),c(),void 0===o&&f>e?m():!0!==t&&(l=setTimeout(o?b:m,void 0===o?e-f:e)))}return"boolean"!=typeof t&&(o=n,n=t,t=void 0),i.cancel=function(){c(),r=!0},i}function t(t,n,o){return void 0===o?e(t,n,!1):e(t,o,!1!==n)}function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e,t){return r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},r(e,t)}function a(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return c(e)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function i(e){return i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},i(e)}var s=wp.blocks.createBlock,u=wp.plugins.registerPlugin,p=wp.i18n.__,f=wp.element.Component,m=wp.compose.compose,b=wp.data,y=b.withSelect,v=b.withDispatch,d=wp.components,_=d.PanelRow,k=d.SelectControl,h=(wp.editPost||{}).PluginDocumentSettingPanel,g=(window.lazyblocksTemplatesData||{}).used_post_types_for_templates,w=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}(y,e);var n,u,f,m,b=(f=y,m=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=i(f);if(m){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return a(this,e)});function y(){var e;o(this,y);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return(e=b.call.apply(b,[this].concat(l))).updateBlocksMeta=t(500,e.updateBlocksMeta.bind(c(e))),e}return n=y,(u=[{key:"componentDidUpdate",value:function(){this.update()}},{key:"update",value:function(){this.fallbackTemplateBlocks(),this.updateBlocksMeta()}},{key:"fallbackTemplateBlocks",value:function(){var e=this.props,t=e.templateConvertBlocksToContent,n=e.templateBlocks,o=e.resetBlocks,l=e.insertBlocks,r=e.updateMeta;if(!this.dontRunFallback&&t){this.dontRunFallback=!0;var a=JSON.parse(decodeURIComponent(n));if(a&&a.length){var c=[];a.forEach((function(e){try{c.push(s(e[0]))}catch(e){console.error(e)}})),o([]),l(c)}r("_lzb_template_convert_blocks_to_content",!1)}}},{key:"convertBlocksToTemplate",value:function(e){var t=this,n=[];return e.forEach((function(e){var o=[e.name,e.attributes];e.innerBlocks&&e.innerBlocks.length&&o.push(t.convertBlocksToTemplate(e.innerBlocks)),n.push(o)})),n}},{key:"updateBlocksMeta",value:function(){var e=this.props,t=e.templateBlocks,n=e.blocks,o=e.updateMeta,l=encodeURIComponent(JSON.stringify(this.convertBlocksToTemplate(n)));t!==l&&o("_lzb_template_blocks",l)}},{key:"render",value:function(){var e=this.props,t=e.templateLock,n=e.templatePostTypes,o=e.postTypes,l=e.updateMeta,r=[{label:p("None","lazy-blocks"),value:""},{label:p("Prevent all operations","lazy-blocks"),value:"all"},{label:p("Prevent inserting new blocks, but allows moving existing ones","lazy-blocks"),value:"insert"}],a=[],c=[];return o.filter((function(e){return e.viewable&&"lazyblocks"!==e.slug&&"lazyblocks_templates"!==e.slug&&"attachment"!==e.slug})).forEach((function(e){var t=e.label;e.labels&&e.labels.singular_name&&(t=e.labels.singular_name),c.push(e.slug),a.push({label:t,value:e.slug,disabled:g.includes(e.slug)})})),n&&n.length&&n.forEach((function(e){c.includes(e)||a.push({label:e,value:e})})),wp.element.createElement(h,{name:"LZBTemplateSettings",title:p("Template Settings","lazy-blocks"),className:"lzb-template-settings-panel"},wp.element.createElement(_,null,wp.element.createElement(k,{label:p("Post Types","lazy-blocks"),multiple:!0,options:a,value:n,onChange:function(e){l("_lzb_template_post_types",e)}})),wp.element.createElement(_,null,wp.element.createElement(k,{label:p("Template Lock","lazy-blocks"),options:r,value:t,onChange:function(e){l("_lzb_template_lock",e)}})))}}])&&l(n.prototype,u),y}(f);u("lazy-blocks-template",{render:m(y((function(e){var t=e("core/editor").getEditedPostAttribute,n=e("core").getPostTypes,o=e("core/block-editor").getBlocks,l=t("meta")||{};return{templatePostTypes:l._lzb_template_post_types||[],templateLock:l._lzb_template_lock||"",templateBlocks:l._lzb_template_blocks||"",templateConvertBlocksToContent:l._lzb_template_convert_blocks_to_content||!1,postTypes:n({show_ui:!0,per_page:-1})||[],blocks:o()}})),v((function(e){var t=e("core/block-editor"),n=t.insertBlocks,o=t.resetBlocks,l=e("core/editor").editPost;return{insertBlocks:n,resetBlocks:o,updateMeta:function(e,t){var n,o,r;l({meta:(n={},o=e,r=t,o in n?Object.defineProperty(n,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[o]=r,n)})}}})))(w)})}();